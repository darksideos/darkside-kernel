This code was taken and modified by Theo Tosini from https://github.com/brianwiddas/pi-baremetal